module.exports = (node, graph) => {
  const recipes = {"AI Limiter":{"ingredients":{"copper-sheet":{"name":"Copper Sheet","amount":25},"quickwire":{"name":"Quickwire","amount":100}},"product":{"slug":"ai-limiter","name":"AI Limiter","amount":5}},"Alternate: Adhered Iron Plate":{"ingredients":{"iron-plate":{"name":"Iron Plate","amount":11.25},"rubber":{"name":"Rubber","amount":3.75}},"product":{"slug":"reinforced-iron-plate","name":"Reinforced Iron Plate","amount":3.75}},"Alternate: Alclad Casing":{"ingredients":{"aluminum-ingot":{"name":"Aluminum Ingot","amount":150.0},"copper-ingot":{"name":"Copper Ingot","amount":75.0}},"product":{"slug":"aluminum-casing","name":"Aluminum Casing","amount":112.5}},"Alternate: Bolted Frame":{"ingredients":{"reinforced-iron-plate":{"name":"Reinforced Iron Plate","amount":7.5},"screw":{"name":"Screw","amount":140.0}},"product":{"slug":"modular-frame","name":"Modular Frame","amount":5.0}},"Alternate: Insulated Cable":{"ingredients":{"wire":{"name":"Wire","amount":45},"rubber":{"name":"Rubber","amount":30}},"product":{"slug":"cable","name":"Cable","amount":100}},"Alternate: Quickwire Cable":{"ingredients":{"quickwire":{"name":"Quickwire","amount":7.5},"rubber":{"name":"Rubber","amount":5.0}},"product":{"slug":"cable","name":"Cable","amount":27.5}},"Alternate: Silicon Circuit Board":{"ingredients":{"copper-sheet":{"name":"Copper Sheet","amount":27.5},"silica":{"name":"Silica","amount":27.5}},"product":{"slug":"circuit-board","name":"Circuit Board","amount":12.5}},"Alternate: Caterium Circuit Board":{"ingredients":{"plastic":{"name":"Plastic","amount":12.5},"quickwire":{"name":"Quickwire","amount":37.5}},"product":{"slug":"circuit-board","name":"Circuit Board","amount":8.75}},"Alternate: Coated Iron Canister":{"ingredients":{"iron-plate":{"name":"Iron Plate","amount":30},"copper-sheet":{"name":"Copper Sheet","amount":15}},"product":{"slug":"empty-canister","name":"Empty Canister","amount":60}},"Alternate: Coated Iron Plate":{"ingredients":{"iron-ingot":{"name":"Iron Ingot","amount":50},"plastic":{"name":"Plastic","amount":10}},"product":{"slug":"iron-plate","name":"Iron Plate","amount":75}},"Alternate: Crystal Computer":{"ingredients":{"circuit-board":{"name":"Circuit Board","amount":7.5},"crystal-oscillator":{"name":"Crystal Oscillator","amount":2.8125}},"product":{"slug":"computer","name":"Computer","amount":2.8125}},"Alternate: Fine Concrete":{"ingredients":{"silica":{"name":"Silica","amount":7.5},"limestone":{"name":"Limestone","amount":30.0}},"product":{"slug":"concrete","name":"Concrete","amount":25.0}},"Alternate: Copper Rotor":{"ingredients":{"copper-sheet":{"name":"Copper Sheet","amount":22.5},"screw":{"name":"Screw","amount":195.0}},"product":{"slug":"rotor","name":"Rotor","amount":11.25}},"Alternate: Electric Motor":{"ingredients":{"electromagnetic-control-rod":{"name":"Electromagnetic Control Rod","amount":3.75},"rotor":{"name":"Rotor","amount":7.5}},"product":{"slug":"motor","name":"Motor","amount":7.5}},"Alternate: Electrode Circuit Board":{"ingredients":{"rubber":{"name":"Rubber","amount":30},"petroleum-coke":{"name":"Petroleum Coke","amount":45}},"product":{"slug":"circuit-board","name":"Circuit Board","amount":5}},"Alternate: Electromagnetic Connection Rod":{"ingredients":{"stator":{"name":"Stator","amount":8},"high-speed-connector":{"name":"High-Speed Connector","amount":4}},"product":{"slug":"electromagnetic-control-rod","name":"Electromagnetic Control Rod","amount":8}},"Alternate: Encased Industrial Pipe":{"ingredients":{"steel-pipe":{"name":"Steel Pipe","amount":28},"concrete":{"name":"Concrete","amount":20}},"product":{"slug":"encased-industrial-beam","name":"Encased Industrial Beam","amount":4}},"Alternate: Compacted Coal":{"ingredients":{"coal":{"name":"Coal","amount":25},"sulfur":{"name":"Sulfur","amount":25}},"product":{"slug":"compacted-coal","name":"Compacted Coal","amount":25}},"Alternate: Fused Wire":{"ingredients":{"copper-ingot":{"name":"Copper Ingot","amount":12},"caterium-ingot":{"name":"Caterium Ingot","amount":3}},"product":{"slug":"wire","name":"Wire","amount":90}},"Alternate: Fine Black Powder":{"ingredients":{"sulfur":{"name":"Sulfur","amount":7.5},"compacted-coal":{"name":"Compacted Coal","amount":3.75}},"product":{"slug":"black-powder","name":"Black Powder","amount":15.0}},"Alternate: Heat Exchanger":{"ingredients":{"aluminum-casing":{"name":"Aluminum Casing","amount":30},"rubber":{"name":"Rubber","amount":30}},"product":{"slug":"heat-sink","name":"Heat Sink","amount":10}},"Alternate: Steeled Frame":{"ingredients":{"reinforced-iron-plate":{"name":"Reinforced Iron Plate","amount":2},"steel-pipe":{"name":"Steel Pipe","amount":10}},"product":{"slug":"modular-frame","name":"Modular Frame","amount":3}},"Alternate: OC Supercomputer":{"ingredients":{"radio-control-unit":{"name":"Radio Control Unit","amount":9},"cooling-system":{"name":"Cooling System","amount":9}},"product":{"slug":"supercomputer","name":"Supercomputer","amount":3}},"Alternate: Plutonium Fuel Unit":{"ingredients":{"encased-plutonium-cell":{"name":"Encased Plutonium Cell","amount":10.0},"pressure-conversion-cube":{"name":"Pressure Conversion Cube","amount":0.5}},"product":{"slug":"plutonium-fuel-rod","name":"Plutonium Fuel Rod","amount":0.5}},"Alternate: Fused Quickwire":{"ingredients":{"caterium-ingot":{"name":"Caterium Ingot","amount":7.5},"copper-ingot":{"name":"Copper Ingot","amount":37.5}},"product":{"slug":"quickwire","name":"Quickwire","amount":90.0}},"Alternate: Bolted Iron Plate":{"ingredients":{"iron-plate":{"name":"Iron Plate","amount":90},"screw":{"name":"Screw","amount":250}},"product":{"slug":"reinforced-iron-plate","name":"Reinforced Iron Plate","amount":15}},"Alternate: Stitched Iron Plate":{"ingredients":{"iron-plate":{"name":"Iron Plate","amount":18.75},"wire":{"name":"Wire","amount":37.5}},"product":{"slug":"reinforced-iron-plate","name":"Reinforced Iron Plate","amount":5.625}},"Alternate: Steel Rotor":{"ingredients":{"steel-pipe":{"name":"Steel Pipe","amount":10},"wire":{"name":"Wire","amount":30}},"product":{"slug":"rotor","name":"Rotor","amount":5}},"Alternate: Rubber Concrete":{"ingredients":{"limestone":{"name":"Limestone","amount":50},"rubber":{"name":"Rubber","amount":10}},"product":{"slug":"concrete","name":"Concrete","amount":45}},"Alternate: Cheap Silica":{"ingredients":{"raw-quartz":{"name":"Raw Quartz","amount":11.25},"limestone":{"name":"Limestone","amount":18.75}},"product":{"slug":"silica","name":"Silica","amount":26.25}},"Alternate: Quickwire Stator":{"ingredients":{"steel-pipe":{"name":"Steel Pipe","amount":16},"quickwire":{"name":"Quickwire","amount":60}},"product":{"slug":"stator","name":"Stator","amount":8}},"Alternate: Steel Coated Plate":{"ingredients":{"steel-ingot":{"name":"Steel Ingot","amount":7.5},"plastic":{"name":"Plastic","amount":5.0}},"product":{"slug":"iron-plate","name":"Iron Plate","amount":45.0}},"Alclad Aluminum Sheet":{"ingredients":{"aluminum-ingot":{"name":"Aluminum Ingot","amount":30},"copper-ingot":{"name":"Copper Ingot","amount":10}},"product":{"slug":"alclad-aluminum-sheet","name":"Alclad Aluminum Sheet","amount":30}},"Circuit Board":{"ingredients":{"copper-sheet":{"name":"Copper Sheet","amount":15.0},"plastic":{"name":"Plastic","amount":30.0}},"product":{"slug":"circuit-board","name":"Circuit Board","amount":7.5}},"Electromagnetic Control Rod":{"ingredients":{"stator":{"name":"Stator","amount":6},"ai-limiter":{"name":"AI Limiter","amount":4}},"product":{"slug":"electromagnetic-control-rod","name":"Electromagnetic Control Rod","amount":4}},"Encased Industrial Beam":{"ingredients":{"steel-beam":{"name":"Steel Beam","amount":24},"concrete":{"name":"Concrete","amount":30}},"product":{"slug":"encased-industrial-beam","name":"Encased Industrial Beam","amount":6}},"Fabric":{"ingredients":{"mycelia":{"name":"Mycelia","amount":15},"biomass":{"name":"Biomass","amount":75}},"product":{"slug":"fabric","name":"Fabric","amount":15}},"Black Powder":{"ingredients":{"coal":{"name":"Coal","amount":7.5},"sulfur":{"name":"Sulfur","amount":15.0}},"product":{"slug":"black-powder","name":"Black Powder","amount":7.5}},"Heat Sink":{"ingredients":{"alclad-aluminum-sheet":{"name":"Alclad Aluminum Sheet","amount":37.5},"copper-sheet":{"name":"Copper Sheet","amount":22.5}},"product":{"slug":"heat-sink","name":"Heat Sink","amount":7.5}},"Reinforced Iron Plate":{"ingredients":{"iron-plate":{"name":"Iron Plate","amount":30},"screw":{"name":"Screw","amount":60}},"product":{"slug":"reinforced-iron-plate","name":"Reinforced Iron Plate","amount":5}},"Modular Frame":{"ingredients":{"reinforced-iron-plate":{"name":"Reinforced Iron Plate","amount":3},"iron-rod":{"name":"Iron Rod","amount":12}},"product":{"slug":"modular-frame","name":"Modular Frame","amount":2}},"Motor":{"ingredients":{"rotor":{"name":"Rotor","amount":10},"stator":{"name":"Stator","amount":10}},"product":{"slug":"motor","name":"Motor","amount":5}},"Nobelisk":{"ingredients":{"black-powder":{"name":"Black Powder","amount":15},"steel-pipe":{"name":"Steel Pipe","amount":30}},"product":{"slug":"nobelisk","name":"Nobelisk","amount":3}},"Encased Plutonium Cell":{"ingredients":{"plutonium-pellet":{"name":"Plutonium Pellet","amount":10},"concrete":{"name":"Concrete","amount":20}},"product":{"slug":"encased-plutonium-cell","name":"Encased Plutonium Cell","amount":5}},"Pressure Conversion Cube":{"ingredients":{"fused-modular-frame":{"name":"Fused Modular Frame","amount":1},"radio-control-unit":{"name":"Radio Control Unit","amount":2}},"product":{"slug":"pressure-conversion-cube","name":"Pressure Conversion Cube","amount":1}},"Rotor":{"ingredients":{"iron-rod":{"name":"Iron Rod","amount":20},"screw":{"name":"Screw","amount":100}},"product":{"slug":"rotor","name":"Rotor","amount":4}},"Smart Plating":{"ingredients":{"reinforced-iron-plate":{"name":"Reinforced Iron Plate","amount":2},"rotor":{"name":"Rotor","amount":2}},"product":{"slug":"smart-plating","name":"Smart Plating","amount":2}},
    "Versatile Framework":{"ingredients":{"modular-frame":{"name":"Modular Frame","amount":2.5},"steel-beam":{"name":"Steel Beam","amount":30.0}},"product":{"slug":"versatile-framework","name":"Versatile Framework","amount":5.0}},"Automated Wiring":{"ingredients":{"stator":{"name":"Stator","amount":2.5},"cable":{"name":"Cable","amount":50.0}},"product":{"slug":"automated-wiring","name":"Automated Wiring","amount":2.5}},"Assembly Director System":{"ingredients":{"adaptive-control-unit":{"name":"Adaptive Control Unit","amount":1.5},"supercomputer":{"name":"Supercomputer","amount":0.75}},"product":{"slug":"assembly-director-system","name":"Assembly Director System","amount":0.75}},"Stator":{"ingredients":{"steel-pipe":{"name":"Steel Pipe","amount":15},"wire":{"name":"Wire","amount":40}},"product":{"slug":"stator","name":"Stator","amount":5}}},
    input1 = node.in("Input 1", {}),
    input2 = node.in("Input 2", {}),
    recipeSelector = node.in("Recipe", "AI Limiter", {type: 'dropdown', values: Object.keys(recipes)}),
    output = node.out("Output", {})

  function update() {
    const recipe = recipes[recipeSelector.value]
    if (input1.value.slug && input1.value.slug) {
      let inputs = {}, validInputs = true
      // check if inputs are valid
      inputs[input1.value.slug] = input1.value.amount
      inputs[input2.value.slug] = input2.value.amount
      for (let slug in recipe.ingredients) {
        if (inputs[slug]) delete inputs[slug]
        else validInputs = false
      }
      if (validInputs) {
        const assemblersPerFloor = 3,
          floors = Math.ceil(input1.value.amount / (recipe.ingredients[input1.value.slug].amount * assemblersPerFloor)),
          clock = input1.value.amount / (recipe.ingredients[input1.value.slug].amount * assemblersPerFloor * floors),
          expectedInput2 = recipe.ingredients[input2.value.slug].amount * assemblersPerFloor * floors * clock
        if (input2.value.amount == expectedInput2) {
          output.setValue({slug: recipe.product.slug, amount: recipe.product.amount * assemblersPerFloor * floors * clock})
          node.comment = `${floors} floors of ${assemblersPerFloor} Assemblers @ ${Math.round(clock * 10000) / 100}%
Producing ${output.value.amount} ${recipe.product.name}/min`
        } else {
          output.setValue({})
          node.comment = `Input amount mismatch! For ${recipe.ingredients[input2.value.slug].name}, expected ${expectedInput2} but got ${input2.value.amount}`
        }
      } else {
        output.setValue({})
        node.comment = "Invalid inputs!"
      }
    } else {
      output.setValue({})
      node.comment = "Missing inputs!"
    }
  }
  update()
  for (let inp of [input1, input2, recipeSelector]) {
    inp.onChange = update
  }
};